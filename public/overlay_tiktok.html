<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <title>AI Music Boards – TikTok Live Overlay</title>

<style>
  :root{
    /* TikTok safe zones */
    --safeTop: 210px;
    --safeBottom: 300px;

    /* Theme */
    --panel: rgba(0,0,0,.58);
    --panel2: rgba(0,0,0,.42);
    --border: rgba(255,255,255,.14);
    --text: rgba(255,255,255,.96);
    --muted: rgba(255,255,255,.72);

    --gold:#d4af37;
    --red:#ff3b30;
    --green:#2ecc71;

    /* Compactness */
    --r: 12px;
    --shadow: 0 10px 22px rgba(0,0,0,.32);
    --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Arial, sans-serif;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family: var(--font);
    color: var(--text);
    background: transparent;
    overflow:hidden;
  }
  .stage{ position:relative; width:100vw; height:100vh; }

  /* ===== TikTok HUD cluster (top-left) ===== */
  .hud{
    position:absolute;
    left: 14px;
    top: calc(var(--safeTop) - 140px);
    z-index: 10;

    display:flex;
    flex-direction: column;
    gap: 8px;

    /* hug content so card lines up with end of Review pill */
    width: fit-content;
    max-width: min(520px, 92vw);

    pointer-events:none;
  }

  .row{
    display:flex;
    gap: 8px;
    align-items:center;
    flex-wrap: nowrap; /* keep pills on one line */
  }

  /* Pills */
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 8px 10px;
    border-radius: 999px;

    background: rgba(0,0,0,.38);
    border: 1px solid rgba(255,255,255,.16);

    backdrop-filter: blur(10px);
    box-shadow: 0 12px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.10);
    line-height: 1;
    white-space: nowrap;
    font-weight: 900;
    letter-spacing: .4px;
    text-transform: uppercase;
    font-size: 11px;
  }

  .dot{
    width:8px; height:8px; border-radius:999px;
    background: var(--red);
    box-shadow: 0 0 12px rgba(255,59,48,.55);
    flex: 0 0 auto;
  }

  #reviewPill{ opacity:.78; }
  #reviewPill[data-on="1"]{
    opacity:1;
    border-color: rgba(212,175,55,.45);
    box-shadow: 0 0 18px rgba(212,175,55,.18);
  }
  #reviewPill[data-on="1"] .spark{
    width:8px; height:8px; border-radius:999px;
    background: var(--gold);
    box-shadow: 0 0 14px rgba(212,175,55,.55);
    display:inline-block;
  }
  #reviewPill[data-on="0"] .spark{
    width:8px; height:8px; border-radius:999px;
    background: rgba(255,255,255,.25);
    display:inline-block;
  }

  /* ===== Main card ===== */
  .card{
    width: 100%;
    padding: 14px 14px;
    border-radius: 18px;
    display:flex;
    flex-direction: column;

    /* premium glass layers */
    background:
      radial-gradient(120% 140% at 12% 0%, rgba(212,175,55,.16) 0%, rgba(0,0,0,0) 55%),
      radial-gradient(120% 140% at 88% 15%, rgba(255,255,255,.10) 0%, rgba(0,0,0,0) 55%),
      linear-gradient(180deg, rgba(10,12,20,.74), rgba(6,7,12,.56));

    border: 1px solid rgba(255,255,255,.16);
    box-shadow:
      0 18px 44px rgba(0,0,0,.50),
      inset 0 1px 0 rgba(255,255,255,.14);

    backdrop-filter: blur(14px);
  }

  .cardTop{
    display:flex;
    justify-content: space-between;
    align-items: baseline;
    gap: 10px;
    margin-bottom: 6px;
  }

  .kicker{
    font-size: 11px;
    opacity: .86;
    font-weight: 900;
    letter-spacing: 1.2px;
    text-transform: uppercase;
  }

  .qualify{
    font-size: 10px;
    opacity: .86;
    font-weight: 1000;
    letter-spacing: .6px;
    text-transform: uppercase;
  }
  .qualify b{ color: var(--gold); }

  .artist{
    font-size: 22px;
    font-weight: 1000;
    letter-spacing: .2px;
    text-transform: none;
    line-height: 1.05;
    margin-bottom: 4px;
  }

  .title{
    font-size: 16px;
    font-weight: 650;
    opacity: .88;
    line-height: 1.15;
    margin-bottom: 10px;
  }

  .meta{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    font-size: 12px;
    opacity:.80;
    font-weight: 800;
    letter-spacing: .6px;
    text-transform: uppercase;
  }
  .meta span{
    opacity:.95;
    letter-spacing:.2px;
    text-transform:none;
    font-weight:700;
  }

  /* ===== Scores row ===== */
  .scores{
    display:flex;
    align-items:flex-start;
    gap: 10px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,.10);
  }

  .scoresLabel{
    font-size: 11px;
    opacity:.75;
    font-weight: 900;
    letter-spacing: 1.0px;
    margin-top: 6px;
  }

  .cells{
    display:flex;
    gap: 10px;
    align-items:center;
    flex-wrap: nowrap;
  }

  .cell{
    width: 56px;
    height: 64px;
    border-radius: 16px;

    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    border: 1px solid rgba(255,255,255,.18);
    box-shadow:
      0 12px 20px rgba(0,0,0,.40),
      inset 0 1px 0 rgba(255,255,255,.14);

    display:flex;
    flex-direction: column;
    align-items:center;
    justify-content:center;
    line-height: 1;
  }

  .abbr{
    font-size: 12px;
    opacity: .82;
    font-weight: 900;
    letter-spacing: 1.1px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .val{
    font-size: 22px;
    font-weight: 1000;
  }

  /* Score color classes (your JS depends on these) */
  .s-low{ color: var(--red); }
  .s-mid{ color: rgba(255,255,255,.94); }
  .s-high{ color: var(--gold); }

  /* ===== Verdict bar ===== */
  .verdict{
    margin-top: 12px;
    width: 100%;
    justify-content: space-between;
    padding: 10px 12px;
    border-radius: 999px;

    border: 1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.35);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.10);

    font-weight: 1000;
    letter-spacing: .8px;
    text-transform: uppercase;
    font-size: 12px;

    display:none;
    gap: 10px;
    align-items:center;

    transform: translateY(6px);
    opacity: 0;
    transition: opacity .18s ease, transform .18s ease;
  }

  .verdict[data-state="qualified"],
  .verdict[data-state="rejected"]{
    display:flex;
    opacity: 1;
    transform: translateY(0);
  }

  .verdict[data-state="qualified"]{ border-color: rgba(46,204,113,.45); }
  .verdict[data-state="rejected"]{ border-color: rgba(255,59,48,.45); }

  .tag{
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.14);
    font-size: 11px;
    font-weight: 1000;
    letter-spacing: .6px;
    text-transform: uppercase;
    background: rgba(255,255,255,.06);
  }

  .verdict[data-state="qualified"] .tag{
    background: rgba(46,204,113,.14);
    border-color: rgba(46,204,113,.28);
  }
  .verdict[data-state="rejected"] .tag{
    background: rgba(255,59,48,.14);
    border-color: rgba(255,59,48,.28);
  }

  /* Mobile tuning */
  @media (max-width: 520px){
    :root{ --safeTop: 195px; --safeBottom: 320px; }
    .hud{ max-width: 94vw; top: calc(var(--safeTop) - 150px); }
    .cell{ width: 50px; height: 58px; }
    .val{ font-size: 20px; }
    .cells{ flex-wrap: wrap; } /* allow wrap only on small screens */
  }
</style>


</head>

<body>
  <div class="stage">

    <!-- HUD cluster -->
    <div class="hud">
      <div class="row">
        <div class="pill" aria-label="status">
          <span class="dot" aria-hidden="true"></span>
          <span id="brandText">AI MUSIC BOARDS</span>
          <span style="opacity:.75" id="statusText">LIVE</span>
        </div>

        <div class="pill" id="sessionPill">QUEUE: —</div>

        <div class="pill" id="reviewPill" data-on="0">
          <span class="spark" aria-hidden="true"></span>
          <span id="reviewText">REVIEW: OFF</span>
        </div>
      </div>

      <div class="card" aria-label="now reviewing">
        <div class="cardTop">
          <div class="kicker">NOW REVIEWING</div>
          <div class="qualify">QUALIFY <b>40+</b></div>
        </div>

        <div class="artist" id="artistName">WAITING…</div>
        <div class="title" id="trackTitle">“—”</div>

        <div class="meta">
          <div>GENRE: <span id="trackGenre">—</span></div>
        </div>

        <div class="scores" aria-label="scores">
          <div class="scoresLabel">SCORES</div>

          <div class="cells">
            <!-- These IDs are kept exactly as your overlay already uses -->
            <div class="cell" id="cellLyrics">
              <div class="abbr">LYR</div>
              <div class="val s-mid" id="scoreLyrics">0</div>
            </div>

            <div class="cell" id="cellDelivery">
              <div class="abbr">DEL</div>
              <div class="val s-mid" id="scoreDelivery">0</div>
            </div>

            <div class="cell" id="cellProduction">
              <div class="abbr">PROD</div>
              <div class="val s-mid" id="scoreProduction">0</div>
            </div>

            <div class="cell" id="cellOriginality">
              <div class="abbr">ORG</div>
              <div class="val s-mid" id="scoreOriginality">0</div>
            </div>

            <div class="cell" id="cellReplay">
              <div class="abbr">RPL</div>
              <div class="val s-mid" id="scoreRepeatability">0</div>
            </div>
          </div>
        </div>
        <!-- ✅ VERDICT GOES HERE (inside the card) -->
        <div class="verdict" id="verdictBar" data-state="">
          <span id="verdictText">—</span>
          <span class="tag" id="verdictTag">—</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Config =====
    const API = "https://aimusicboards.com";
    const POLL_MS = 1500;   // snappier for live overlays
    const QUALIFY_MIN = 40;
    const DEBUG = false;

    // ===== Helpers =====
    function $(id){ return document.getElementById(id); }

    function setText(id, text){
      const el = $(id);
      if (el) el.textContent = text;
    }

    function scoreClass(n){
      const v = Number(n || 0);
      if (v <= 3) return "s-low";
      if (v >= 8) return "s-high";
      return "s-mid";
    }

    function setScore(id, n){
      const el = $(id);
      if (!el) return;
      el.textContent = String(n ?? 0);
      el.classList.remove("s-low","s-mid","s-high");
      el.classList.add(scoreClass(n));
    }

    function setVerdict(state, text, tag){
      const bar = $("verdictBar");
      if (!bar) return;
      bar.setAttribute("data-state", state || "");
      setText("verdictText", text || "—");
      setText("verdictTag", tag || "—");
    }

    function setReview(on){
      const pill = $("reviewPill");
      if (!pill) return;
      pill.setAttribute("data-on", on ? "1" : "0");
      setText("reviewText", on ? "REVIEW: IN PROGRESS" : "REVIEW: OFF");
    }

    async function getJSON(url){
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
      return res.json();
    }

    // ===== API Pollers =====
    async function fetchStatus(){
      try{
        const data = await getJSON(`${API}/api/status`);
        const q = data.queue_count ?? "—";
        setText("sessionPill", `QUEUE: ${q}`);
      }catch(e){
        if (DEBUG) console.warn("status:", e);
      }
    }

    async function fetchNowPlaying(){
      try{
        const data = await getJSON(`${API}/api/now_playing`);
        const np = data.now_playing || null;

        if (!np || np.active === false){
          setText("artistName","WAITING…");
          setText("trackTitle","“—”");
          setText("trackGenre","—");

          setScore("scoreLyrics",0);
          setScore("scoreDelivery",0);
          setScore("scoreProduction",0);
          setScore("scoreOriginality",0);
          setScore("scoreRepeatability",0);

          setReview(false);
          setVerdict("", "—", "—");
          return;
        }

        // Identity
        setText("artistName", (np.artist_name || "—").toUpperCase());
        setText("trackTitle", np.track_title ? `“${np.track_title}”` : "“—”");
        setText("trackGenre", (np.genre || "—").toString());

        // Review indicator
        setReview(!!np.is_playing);

        // Scores (match your admin payload keys)
        const lyrics = Number(np.lyrics || 0);
        const delivery = Number(np.delivery || 0);
        const production = Number(np.production || 0);
        const originality = Number(np.originality || 0);
        const replay = Number(np.replay || 0);

        setScore("scoreLyrics", lyrics);
        setScore("scoreDelivery", delivery);
        setScore("scoreProduction", production);
        setScore("scoreOriginality", originality);
        setScore("scoreRepeatability", replay);

        const computedTotal = lyrics + delivery + production + originality + replay;
        const total = Number.isFinite(Number(np.total)) ? Number(np.total) : computedTotal;

        // Verdict only when final
        if (!np.final){
          setVerdict("", "—", "—");
          return;
        }

        setReview(false);

        if (total >= QUALIFY_MIN){
          setVerdict("qualified", `TOTAL ${total} • QUALIFIED`, "MAKES THE BOARD");
        }else{
          setVerdict("rejected", `TOTAL ${total} • REJECTED`, "BELOW 40");
        }

      }catch(e){
        if (DEBUG) console.warn("now_playing:", e);
      }
    }

    async function tick(){
      await Promise.allSettled([
        fetchStatus(),
        fetchNowPlaying()
      ]);
    }

    tick();
    setInterval(tick, POLL_MS);
  </script>

</body>
</html>
