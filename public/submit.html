<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Submit • AI Music Boards</title>

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#000000">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #07070c;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.68);

      --gold: #d4af37;
      --green: #2ecc71;
      --blue: #4aa3ff;
      --red: #ff3b30;

      --cta: #f08a2a;
      --cta2: #ff9c45;

      --radius: 18px;
      --shadow: 0 18px 50px rgba(0,0,0,.45);

      --max: 1180px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x:hidden;
    }
    a{ color:inherit; text-decoration:none; }

    .wrap{
      width: min(var(--max), calc(100% - 48px));
      margin: 0 auto;
    }

    /* ---------- Top Nav (matches homepage) ---------- */
    header{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7,7,12,.78), rgba(7,7,12,.28));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .nav{
      height: 74px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 18px;
    }
    .brand{
      font-weight: 900;
      letter-spacing: .6px;
      text-transform: uppercase;
      font-size: 20px;
      white-space: nowrap;
    }
    .navlinks{
      display:flex;
      align-items:center;
      gap: 22px;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      color: rgba(255,255,255,.82);
    }
    .navlinks a{ opacity:.9; }
    .navlinks a:hover{ opacity:1; }
    .navright{
      display:flex;
      align-items:center;
      gap: 12px;
      white-space: nowrap;
    }

    /* ---------- Buttons / Pills (matches homepage) ---------- */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight: 800;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .4px;
      cursor: pointer;
      user-select: none;
    }
    .btn:hover{ background: rgba(255,255,255,.09); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(109,92,255,.95), rgba(74,163,255,.85));
      border-color: rgba(255,255,255,.14);
    }
    .btn.cta{
      background: linear-gradient(180deg, var(--cta2), var(--cta));
      border-color: rgba(0,0,0,.2);
      color: #1a0f05;
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: 0 14px 38px rgba(0,0,0,.35);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      font-weight: 900;
      letter-spacing: .4px;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(255,255,255,.86);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      white-space: nowrap;
    }
    .dot{
      width: 10px; height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.35);
      flex: 0 0 auto;
    }
    .dot.on{
      background: var(--green);
      box-shadow: 0 0 18px rgba(46,204,113,.45);
    }

    /* ---------- Submit Page Hero Shell (matches homepage vibe) ---------- */
    .page{
      position: relative;
      padding: 38px 0 64px;
      isolation: isolate;
    }
    .page::before{
        content:"";
        position:absolute;
        inset: 0;
        z-index: -2;

        /* Cloudflare hosted background image */
        background:
            url("https://imagedelivery.net/fYqzQPf1CS3qAF1vZpfSLw/42152f3a-e151-490f-caa5-034ff31e6100/public")
                center / cover no-repeat,
            var(--bg);

        /* Slight enhancement for depth */
        filter: saturate(1.05) contrast(1.05);
    }
    .page::after{
        content:"";
        position:absolute;
        inset:0;
        z-index:-1;

        /* Overlay gradients for readability + homepage vibe */
        background:
            radial-gradient(1200px 700px at 50% 18%, rgba(109,92,255,.22), rgba(0,0,0,0) 60%),
            radial-gradient(1100px 650px at 70% 42%, rgba(74,163,255,.18), rgba(0,0,0,0) 58%),
            radial-gradient(900px 520px at 30% 60%, rgba(212,175,55,.10), rgba(0,0,0,0) 62%),
            linear-gradient(to bottom, rgba(0,0,0,.25), rgba(7,7,12,.92));

        pointer-events:none;
    }

    /* Centered content like homepage */
    .submit-shell{
      max-width: 820px;
      margin: 0 auto;
    }

    .title-row{
      text-align:center;
      margin-bottom: 16px;
    }
    .kicker{
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .7px;
      text-transform: uppercase;
      color: rgba(255,255,255,.70);
      margin-bottom: 10px;
    }
    .h1{
      margin: 0 0 10px 0;
      font-size: clamp(28px, 4.2vw, 46px);
      font-weight: 900;
      letter-spacing: -.6px;
      text-transform: uppercase;
      text-shadow: 0 10px 36px rgba(0,0,0,.55);
    }
    .sub{
      margin: 0 auto;
      max-width: 700px;
      color: rgba(255,255,255,.75);
      line-height: 1.45;
      font-size: 15px;
    }

    /* Main card (matches homepage cards) */
    .card{
      margin-top: 18px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
      position: relative;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(900px 260px at 50% 0%, rgba(109,92,255,.18), rgba(0,0,0,0) 60%),
        radial-gradient(850px 240px at 50% 42%, rgba(212,175,55,.12), rgba(0,0,0,0) 60%);
      pointer-events:none;
    }

    .card-inner{
      position: relative;
      padding: 18px;
    }

    /* Status strip */
    .status{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.34);
      padding: 12px 12px;
      display:flex;
      align-items:flex-start;
      gap: 10px;
      margin-bottom: 14px;
    }
    .status .dot{ margin-top: 4px; }
    .status .st-title{
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .6px;
      font-size: 12px;
      color: rgba(255,255,255,.82);
      margin-bottom: 4px;
    }
    .status .st-body{
      color: rgba(255,255,255,.74);
      font-size: 13px;
      line-height: 1.35;
    }
    .status.closed{
      border-color: rgba(255,59,48,.28);
      background: rgba(255,59,48,.10);
    }
    .status.open{
      border-color: rgba(46,204,113,.30);
      background: rgba(46,204,113,.10);
    }

    /* Form layout */
    form{ margin-top: 10px; }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    label{
      display:block;
      margin: 12px 0 6px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .55px;
      font-size: 12px;
      color: rgba(255,255,255,.78);
    }

    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.32);
      color: rgba(255,255,255,.92);
      outline: none;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,.45); }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(74,163,255,.40);
      box-shadow: 0 0 0 3px rgba(74,163,255,.12), 0 12px 26px rgba(0,0,0,.30);
    }
    textarea{ resize: vertical; min-height: 110px; }

    .full{ grid-column: 1 / -1; }

    .muted{ color: rgba(255,255,255,.70); }
    .hint{ margin: 10px 0 0; font-size: 13px; line-height: 1.4; }
    .filehint{ margin: 8px 0 0; font-size: 13px; line-height: 1.4; }

    /* Warning/Notice blocks match style */
    .block{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.34);
      font-size: 13px;
      line-height: 1.4;
    }
    .block strong{ color: var(--gold); }
    .block.warning{
      border-color: rgba(212,175,55,.45);
      background: rgba(212,175,55,.10);
    }

    /* Ack row */
    .ack{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.34);
      display:flex;
      gap: 10px;
      align-items:flex-start;
      font-size: 13px;
      line-height: 1.4;
    }
    .ack strong{ color: var(--gold); }
    .ack input{
      width: auto;
      margin-top: 2px;
      transform: scale(1.1);
      accent-color: var(--gold);
    }
    .ack label{
      margin: 0;
      font-weight: 700;
      text-transform: none;
      letter-spacing: 0;
      font-size: 13px;
      color: rgba(255,255,255,.78);
    }

    /* Priority buttons */
    .prio-row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .prio-row button{
      margin:0;
      width:auto;
      flex:1;
      padding: 12px;
      border-radius: 14px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .45px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }
    .prio-row button:hover{ background: rgba(255,255,255,.09); }
    .btn-free{
      background: rgba(255,255,255,.92);
      color: #000;
      border-color: rgba(255,255,255,.20);
    }
    .btn-skip{
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
    }
    .btn-upnext{
      background: linear-gradient(180deg, rgba(212,175,55,.92), rgba(212,175,55,.72));
      color:#1a1406;
      border-color: rgba(0,0,0,.18);
    }

    /* Primary submit button (kept hidden per your logic, but styled) */
    button[type="submit"]{
      margin-top: 14px;
      width: 100%;
      padding: 14px;
      border-radius: 14px;
      border: 0;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .45px;
      cursor:pointer;
      background: linear-gradient(180deg, var(--cta2), var(--cta));
      color: #1a0f05;
      box-shadow: 0 14px 38px rgba(0,0,0,.35);
    }

    #msg{ margin-top: 12px; }

    /* Footer helper row */
    .footrow{
      display:flex;
      justify-content:center;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    /* Responsive */
    @media (max-width: 980px){
      .navlinks{ display:none; }
    }
    @media (max-width: 740px){
      .wrap{ width: calc(100% - 28px); }
      .nav{ height: 68px; }
      .brand{ font-size: 18px; }
      .grid{ grid-template-columns: 1fr; }
      .prio-row{ flex-direction: column; }
      .prio-row button{ flex: unset; width: 100%; }
    }
  </style>
</head>

<body>
  <!-- NAV (same as homepage) -->
  <header>
    <div class="wrap">
      <div class="nav">
        <div class="brand">AI MUSIC BOARDS</div>

        <nav class="navlinks" aria-label="primary">
          <a href="https://aimusicboards.com/">Home</a>
          <a href="/board.html">Leaderboard</a>
          <a href="/submit.html" aria-current="page">Submit Music</a>
        </nav>

       <div class="navright">
  <a class="btn primary live-btn is-offline"
     href="https://www.tiktok.com/@snapink.official"
     target="_blank"
     rel="noopener">
    <span class="live-dot"></span>
    <span class="live-label">VIEW CHANNEL</span>
  </a>
</div>
      </div>
    </div>
  </header>

  <!-- PAGE -->
  <main class="page">
    <div class="wrap">
      <div class="submit-shell">
        <div class="title-row">
          <div class="kicker">Submission Portal</div>
          <h1 class="h1">Artist Submission</h1>
          <p class="sub">Free submissions pause automatically when the queue is full. Paid Priority Review is always available (Skip the Line / Up Next).</p>
        </div>

        <section class="card" aria-label="Submit form card">
          <div class="card-inner">

            <!-- Status -->
            <div id="status" class="status">
              <span class="dot"></span>
              <div>
                <div class="st-title">Checking status…</div>
                <div class="st-body">Please wait.</div>
              </div>
            </div>

            <form id="f" style="display:none">
              <div class="grid">
                <div>
                  <label>Artist name</label>
                  <input name="artist_name" required />
                </div>

                <div>
                  <label>Track title</label>
                  <input name="track_title" required />
                </div>

                <div class="full">
                  <label>Genre</label>
                  <input name="genre" required placeholder="R&B, Rap, Rock, Pop, etc." />
                </div>

                <div class="full">
                  <label>Upload track (MP3/WAV only)</label>
                  <input id="track_file" type="file" accept=".mp3,.wav,audio/mpeg,audio/wav" required />
                  <p class="muted filehint">Max 15MB. Only MP3 or WAV.</p>
                </div>
              </div>

              <!-- NEW: store R2 object key (uploads/<uuid>.mp3) -->
              <input type="hidden" name="track_key" id="track_key" value="" />

              <!-- Legacy field kept but unused now -->
              <input type="hidden" name="track_url" id="track_url" value="" />

              <label>Notes (optional)</label>
              <textarea name="notes" rows="4" placeholder="Anything you want Mike to know…"></textarea>

              <div class="block warning">
                <strong>Important:</strong> This board is for evaluating <em>AI music with human-written lyrics</em>.
                Submissions using fully AI-generated lyrics may be disqualified.
              </div>

              <div class="ack">
                <input type="checkbox" id="lyricsConfirm" required />
                <label for="lyricsConfirm">
                  I confirm that the <strong>lyrics were written by me (the artist)</strong> and are not fully generated by AI.
                </label>
              </div>

              <label>Priority (optional)</label>
              <div class="prio-row">
                <button type="button" id="btnFree" class="btn-free">Free Submit</button>
                <button type="button" id="btnSkip" class="btn-skip">$5 Skip the Line</button>
                <button type="button" id="btnUpNext" class="btn-upnext">$20 Up Next</button>
              </div>

              <p class="muted hint">
                $5 moves your track ahead of the free queue.
                <br>
                <strong>$20 puts your track up next for review.</strong>
              </p>

              <div class="block">
                <strong>Fair Play Policy:</strong>
                For fairness, two paid skips are followed by one free review.
              </div>

              <!-- Keep your legacy submit hidden (your JS can trigger paid flows instead) -->
              <button type="submit" id="legacySubmit" style="display:none">Submit</button>

              <p id="msg" class="muted"></p>
            </form>

            <div class="footrow">
              <a class="btn" href="https://aimusicboards.com/">Back Home</a>
              <a class="btn" href="/board.html">View Leaderboard</a>
              <a class="btn primary" href="https://www.tiktok.com/@snapink.official" target="_blank" rel="noopener">Watch Live</a>
            </div>

          </div>
        </section>
      </div>
    </div>
  </main>

<script>
const statusEl = document.getElementById("status");
const form = document.getElementById("f");
const msg = document.getElementById("msg");
const lyricsConfirm = document.getElementById("lyricsConfirm");

const btnFree = document.getElementById("btnFree");
const btnSkip = document.getElementById("btnSkip");
const btnUpNext = document.getElementById("btnUpNext");

const fileEl = document.getElementById("track_file");
const trackKeyHidden = document.getElementById("track_key");
const trackUrlHidden = document.getElementById("track_url");

let STATUS = {
  freeOpen: false,
  paidOpen: true,
  freeCount: 0,
  paidCount: 0,
  cap: 50,
  mode: "manual"
};

function setStatusBox({ type, title, body }) {
  // keep your nice status layout (dot + text)
  statusEl.className = "status " + type;
  statusEl.innerHTML = `
    <span class="dot ${type === "open" ? "on" : ""}"></span>
    <div>
      <div class="st-title">${title}</div>
      <div class="st-body">${body}</div>
    </div>
  `;
}

function setButtonEnabled(btn, enabled) {
  if (!btn) return;
  btn.disabled = !enabled;
  btn.style.opacity = enabled ? "1" : "0.55";
  btn.style.cursor = enabled ? "pointer" : "not-allowed";
}

async function refreshStatus() {
  try {
    const r = await fetch("/api/status", { cache: "no-store" });
    const j = await r.json();

    STATUS.freeCount = Number(j.free_queue_count ?? j.queue_count ?? 0);
    STATUS.paidCount = Number(j.paid_queue_count ?? 0);
    STATUS.cap = Number(j.submissions_max_queue ?? 50);
    STATUS.mode = String(j.submissions_mode ?? "manual");

    // Paid follows backend (default true if missing)
    STATUS.paidOpen = (j.submissions_open_paid !== undefined)
      ? !!j.submissions_open_paid
      : true;

    // Free ignores backend toggle — ONLY capacity matters
    STATUS.freeOpen = (STATUS.freeCount < STATUS.cap);

    // Form should be available if ANY submission path is available
    const showForm = STATUS.freeOpen || STATUS.paidOpen;

    if (!showForm) {
      setStatusBox({
        type: "closed",
        title: "Submissions paused",
        body: "Please check back soon."
      });
      form.style.display = "none";
      return;
    }

    // Always show the form so paid can still happen even if free is full
    form.style.display = "block";

    // Hide free queue count until it’s meaningful (0–10)
    const showCount = STATUS.freeCount > 10;
    const freeQueueText = showCount
      ? `Free queue: ${STATUS.freeCount}/${STATUS.cap} • `
      : "";

    if (STATUS.freeOpen) {
      setStatusBox({
        type: "open",
        title: "Free submissions OPEN",
        body: `${freeQueueText}Priority reviews available anytime`
      });
    } else {
      setStatusBox({
        type: "closed",
        title: "Free submissions PAUSED (queue full)",
        body: `${freeQueueText}Priority reviews remain open`
      });
    }

    // Button gating
    setButtonEnabled(btnFree, STATUS.freeOpen);
    setButtonEnabled(btnSkip, true);
    setButtonEnabled(btnUpNext, true);

  } catch (e) {
    // If status fails, still allow paid route (best UX)
    STATUS = {
      freeOpen: false,
      paidOpen: true,
      freeCount: 0,
      paidCount: 0,
      cap: 50,
      mode: "manual"
    };

    setStatusBox({
      type: "closed",
      title: "Status unavailable",
      body: "You can still try Paid Priority Review."
    });

    form.style.display = "block";
    setButtonEnabled(btnFree, false);
    setButtonEnabled(btnSkip, true);
    setButtonEnabled(btnUpNext, true);
  }
}
function disableAll(disabled) {
  // IMPORTANT: for paid to work even when free is closed,
  // we only disable during upload/submit action, not based on STATUS
  [btnFree, btnSkip, btnUpNext].forEach(b => {
    if (!b) return;
    b.disabled = !!disabled;
    b.style.opacity = disabled ? "0.6" : (b.id === "btnFree" && !STATUS.freeOpen ? "0.55" : "1");
    b.style.cursor = disabled ? "not-allowed" : "pointer";
  });
  if (fileEl) fileEl.disabled = !!disabled;
}

function buildPayload() {
  const fd = new FormData(form);
  const payload = Object.fromEntries(fd.entries());
  payload.lyrics_confirmed = true;
  return payload;
}

function getSelectedFileOrThrow() {
  const file = fileEl?.files?.[0];
  if (!file) throw new Error("Please select an MP3 or WAV file.");

  const name = (file.name || "").toLowerCase();
  const okExt = name.endsWith(".mp3") || name.endsWith(".wav");
  if (!okExt) throw new Error("Only MP3 or WAV files are accepted.");

  const maxBytes = 15 * 1024 * 1024;
  if (file.size > maxBytes) throw new Error("File too large (max 15MB).");

  return file;
}

async function uploadAudioFile(file) {
  const fd = new FormData();
  fd.append("file", file);

  const r = await fetch("/api/upload_audio", { method: "POST", body: fd });
  const j = await r.json().catch(() => ({}));

  if (!r.ok || !j.ok || !j.key) {
    throw new Error((j && j.error) ? j.error : "Upload failed.");
  }
  return { key: j.key, audio_url: j.audio_url || "" };
}

async function createSubmission({ allowFree } = { allowFree: false }) {
  if (!lyricsConfirm.checked) {
    msg.textContent = "You must confirm that your lyrics were written by you.";
    return null;
  }

  const payload = buildPayload();

  if (!payload.artist_name || !payload.track_title || !payload.genre) {
    msg.textContent = "Please fill out all required fields.";
    return null;
  }

  // If they clicked FREE but free is closed, stop early with a helpful message
  if (allowFree && !STATUS.freeOpen) {
    msg.textContent = "Free queue is currently full. Choose a paid option or check back soon.";
    return null;
  }

  let file;
  try {
    file = getSelectedFileOrThrow();
  } catch (e) {
    msg.textContent = String(e.message || e);
    return null;
  }

  msg.textContent = "Uploading audio…";
  disableAll(true);

  let up;
  try {
    up = await uploadAudioFile(file);
  } catch (e) {
    msg.textContent = String(e.message || e);
    disableAll(false);
    return null;
  }

  if (trackKeyHidden) trackKeyHidden.value = up.key;
  if (trackUrlHidden) trackUrlHidden.value = "";

  const payload2 = buildPayload();
  if (!payload2.track_key) {
    msg.textContent = "Upload succeeded, but no track key was returned.";
    disableAll(false);
    return null;
  }

  msg.textContent = "Submitting…";

  const r = await fetch("/api/submit", {
    method: "POST",
    headers: {"content-type":"application/json"},
    body: JSON.stringify(payload2)
  });

  const j = await r.json().catch(() => ({}));

  if (!r.ok) {
    msg.textContent = (j && j.error) ? j.error : "Submission failed.";
    disableAll(false);
    return null;
  }

  return j.id;
}

async function startPaidCheckout(submissionId, paidType) {
  msg.textContent = "Redirecting to secure checkout…";

  const r = await fetch("/api/paid_checkout", {
    method: "POST",
    headers: {"content-type":"application/json"},
    body: JSON.stringify({ submission_id: submissionId, paid_type: paidType })
  });

  const j = await r.json().catch(() => ({}));

  if (!r.ok || !j.checkout_url) {
    msg.textContent = (j && j.error) ? j.error : "Could not start checkout.";
    disableAll(false);
    return;
  }

  window.location.href = j.checkout_url;
}

btnFree?.addEventListener("click", async () => {
  const id = await createSubmission({ allowFree: true });
  if (!id) return;

  msg.textContent = "Submitted! You’re in the queue.";
  form.reset();
  if (trackKeyHidden) trackKeyHidden.value = "";
  if (trackUrlHidden) trackUrlHidden.value = "";
  disableAll(false);

  // Refresh status after a free submission (cap might flip)
  refreshStatus();
});

btnSkip?.addEventListener("click", async () => {
  const id = await createSubmission({ allowFree: false });
  if (!id) return;
  await startPaidCheckout(id, "SKIP");
});

btnUpNext?.addEventListener("click", async () => {
  const id = await createSubmission({ allowFree: false });
  if (!id) return;
  await startPaidCheckout(id, "UPNEXT");
});

form?.addEventListener("submit", (e) => e.preventDefault());

refreshStatus();
setInterval(refreshStatus, 5000);
</script>
</body>
</html>
